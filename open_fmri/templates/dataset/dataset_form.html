{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load staticfiles %}

{% block title %}
{% if object.pk %}
    Update Dataset
{% else %}
    Create Dataset
{% endif %}
{% endblock %}

{% block content %}
    {% if object.pk %}
        <h2>Update Dataset</h2>
    {% else %}
        <h2>Create Dataset</h2>
    {% endif %}

    <form action="" method="post" enctype="multipart/form-data">{% csrf_token %}
    {% crispy form %}

    <div id="id_revision">
    {% crispy revision_formset revision_formset_helper %}
    </div>

    <div id="id_investigator">
        {% crispy investigator_formset investigator_formset_helper %}
    </div>
   
    <div id="id_publication_document">
        {% crispy publication_document_formset publication_document_formset_helper %}
    </div>

    <div id="id_publication_pubmed_link">
        {% crispy publication_pubmed_link_formset publication_pubmed_link_formset_helper %}
    </div>
    
    <div id="id_publication_document">
        {% crispy publication_document_formset publication_document_formset_helper %}
    </div>
    <input class="btn btn-primary" type="submit" value="Save">

    <div id="id_management_forms">
    {{ investigator_formset.management_form }}
    {{ publication_document_formset.management_form }}
    {{ publication_pubmed_link_formset.management_form }}
    {{ task_formset.management_form }}
    {{ revision_formset.management_form }}
    </div>
    </form>
{% endblock %}
{% block javascript %}
{{ block.super }}
    <script>
    $(document).ready(function() {
        $('#id_revision .fieldset-control').formset({
            addText: 'Add Revision',
            deleteText: 'Remove',
            prefix: '{{ revision_formset.prefix }}',
            formCssClass: '{{ revision_formset.prefix }}'
        });
    })

    $(document).ready(function() {
        $('#id_investigator').formset({
            addText: 'Add Investigator',
            deleteText: 'Remove',
            prefix: '{{ investigator_formset.prefix }}',
            formCssClass: '{{ investigator_formset.prefix }}'
        });
    })

    
    $(document).ready(function() {
        $('#id_publication_document .fieldset-control').formset({
            addText: 'Add Publication Document',
            deleteText: 'Remove',
            prefix: 'id_publication_document_set',
            formCssClass: 'id_publication_document_set'
        });
    })

    $(document).ready(function() {
        $('#id_publication_pubmed_link .fieldset-control').formset({
            addText: 'Add Publication PubMed Link',
            deleteText: 'Remove',
            prefix: '{{ publication_pubmed_link_formset.prefix }}',
            formCssClass: '{{ publication_pubmed_link_formset.prefix }}'
        });
    })

    $(document).ready(function() {
        $('#id_task .fieldset-control').formset({
            addText: 'Add Task',
            deleteText: 'Remove',
            prefix: '{{ task_formset.prefix }}',
            formCssClass: '{{ task_formset.prefix }}'
        });
    })

    </script>
{% endblock %}
