{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load staticfiles %}
{% block title %}
{% if object.pk %}
    Update Dataset
{% else %}
    Create Dataset
{% endif %}
{% endblock %}

{% block content %}
    <form action="" method="post" enctype="multipart/form-data">{% csrf_token %}
    <table class= "dataset_form table table-bordered">
    {{ form.as_table }}
    </table>
    
    <table id="id_investigator_table" class="table">
        {% for form in investigator_formset %}
            <tr>
            <td>
                {% for field in form.hidden_fields %}{{ field }}{% endfor %}
                {% if form.instance.pk %}{{ form.DELETE }}{% endif %}
                {{ form.investigator.label_tag }}
            </td>
            <td>
                {{ form.investigator }}
            </td>
            </tr>
        {% endfor %}
    </table>
    
    <table id="id_publication_document_table" class="table">
        {% for form in publication_document_formset %}
            <tr>
            <td>
                {% for field in form.hidden_fields %}{{ field }}{% endfor %}
                {% if form.instance.pk %}{{ form.DELETE }}{% endif %}
                {{ form.document.label_tag }}
            </td>
            <td>
                {{ form.document }}
            </td>
            </tr>
        {% endfor %}
    </table>

    <table id="id_publication_pubmed_link_table" class="table">
        {% for form in publication_pubmed_link_formset %}
            <tbody>
            <tr>
            <td>
                {% for field in form.hidden_fields %}{{ field }}{% endfor %}
                {% if form.instance.pk %}{{ form.DELETE }}{% endif %}
                {{ form.title.label_tag }}
            </td>
            <td>
                {{ form.title}}
            </td>
            </tr>
            <tr>
            <td>
                {{ form.url.label_tag }}
            </td>
            <td>
                {{ form.url }}
            </td>
            </tr>
            </tbody>
        {% endfor %}
    </table>

    <table id="id_task_table" class="table">
        <thead>
        <tr>
        {% for field in task_formset.form.base_fields %}
        <th>
            {{ field }}
        </th>
        {% endfor %}
        </tr>
        </thead>
        {% for form in task_formset %}
            <tbody>
            <tr>
            <td>
                {% for field in form.hidden_fields %}{{ field }}{% endfor %}
                {% if form.instance.pk %}{{ form.DELETE }}{% endif %}
                {{ form.cogat_id }}
            </td>
            <td>
                {{ form.number }}
            </td>
            </tr>
            </tbody>
        {% endfor %}
    </table>

    <input class="btn btn-primary" type="submit" value="Save">

    {{ investigator_formset.management_form }}
    {{ publication_document_formset.management_form }}
    {{ publication_pubmed_link_formset.management_form }}
    {{ task_formset.management_form }}
    </form>
{% endblock %}
{% block javascript %}
{{ block.super }}
    <script>
    $(document).ready(function() {
        $('#id_investigator_table tr').formset({
            addText: 'Add Investigator',
            deleteText: 'Remove',
            prefix: '{{ investigator_formset.prefix }}',
            formCssClass: '{{ investigator_formset.prefix }}'
        });
    })

    
    $(document).ready(function() {
        $('#id_publication_document_table tr').formset({
            addText: 'Add Publication Document',
            deleteText: 'Remove',
            prefix: '{{ publication_document_formset.prefix }}',
            formCssClass: '{{ publication_document_formset.prefix }}'
        });
    })

    $(document).ready(function() {
        $('#id_publication_pubmed_link_table tbody').formset({
            addText: 'Add Publication PubMed Link',
            deleteText: 'Remove',
            prefix: '{{ publication_pubmed_link_formset.prefix }}',
            formCssClass: '{{ publication_pubmed_link_formset.prefix }}'
        });
    })

    $(document).ready(function() {
        $('#id_task_table tbody').formset({
            addText: 'Add Task',
            deleteText: 'Remove',
            prefix: '{{ task_formset.prefix }}',
            formCssClass: '{{ task_formset.prefix }}'
        });
    })

    </script>
{% endblock %}
